<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!-- git web interface version 1.4.5-rc0.GIT, (C) 2005-2006, Kay Sievers <kay.sievers@vrfy.org>, Christian Gierke -->
<!-- git core binaries version 1.5.2.4 -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="generator" content="gitweb/1.4.5-rc0.GIT git/1.5.2.4"/>
<meta name="robots" content="index, nofollow"/>
<title>git.kernel.org - linux/kernel/git/davem/sparc-2.6.git/commitdiff</title>
<link rel="stylesheet" type="text/css" href="gitweb.css"/>
<link rel="alternate" title="linux/kernel/git/davem/sparc-2.6.gitlog RSS feed" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=rss" type="application/rss+xml" />
<link rel="alternate" title="linux/kernel/git/davem/sparc-2.6.gitlog Atom feed" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=atom" type="application/atom+xml" />
<link rel="shortcut icon" href="git-favicon.png" type="image/png"/>
</head>
<body>
<div class="page_header">
<a title="git homepage" href="http://git.or.cz/"><img src="git-logo.png" width="72" height="27" alt="git" class="logo"/></a><a href="/">/pub/scm</a> / <a href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=summary">linux/kernel/git/davem/sparc-2.6.git</a> / commitdiff
<form method="get" action="/" enctype="application/x-www-form-urlencoded">
<div class="search">
<input type="hidden" name="p" value="linux/kernel/git/davem/sparc-2.6.git"  />
<input type="hidden" name="a" value="search"  />
<input type="hidden" name="h" value="27997abfcb1f8bb534720b18f3487de3906c7ac6"  />
<select name="st" >
<option selected="selected" value="commit">commit</option>
<option value="author">author</option>
<option value="committer">committer</option>
<option value="pickaxe">pickaxe</option>
</select><sup><a href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=search_help">?</a></sup> search:
<input type="text" name="s"  />
</div>
</form>
</div>
<div class="page_nav">
<a href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=summary">summary</a> | <a href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=shortlog;h=27997abfcb1f8bb534720b18f3487de3906c7ac6">shortlog</a> | <a href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=log;h=27997abfcb1f8bb534720b18f3487de3906c7ac6">log</a> | <a href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=commit;h=27997abfcb1f8bb534720b18f3487de3906c7ac6">commit</a> | commitdiff | <a href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=tree;h=85aa561169ba7a29f5db898f36de853c56e33926;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6">tree</a><br/>
<a href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=commitdiff_plain;h=27997abfcb1f8bb534720b18f3487de3906c7ac6">raw</a> (parent: <a href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=commitdiff;h=19d50b34bca36a44b570380022863fd2078d3323">19d50b3</a>)<br/>
</div>
<div class="header">
<a class="title" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=commit;h=27997abfcb1f8bb534720b18f3487de3906c7ac6">[SPARC64]: Fix sun4u PCI config space accesses on sun4u.</a>
</div>
<div class="author_date">David S. Miller [Thu, 26 Jul 2007 06:30:16 +0000 (23:30 -0700)]</div>
<div class="page_body">
<div class="log">
Don&#39;t&nbsp;provide&nbsp;fake&nbsp;PCI&nbsp;config&nbsp;space&nbsp;for&nbsp;sun4u.<br/>
<br/>
Also,&nbsp;put&nbsp;back&nbsp;the&nbsp;funny&nbsp;host&nbsp;controller&nbsp;space&nbsp;handling&nbsp;that<br/>
at&nbsp;least&nbsp;Sabre&nbsp;needs.&nbsp;&nbsp;You&nbsp;have&nbsp;to&nbsp;read&nbsp;PCI&nbsp;host&nbsp;controller<br/>
registers&nbsp;at&nbsp;their&nbsp;nature&nbsp;size&nbsp;otherwise&nbsp;you&nbsp;get&nbsp;zeros&nbsp;instead<br/>
of&nbsp;correct&nbsp;values.<br/>
<br/>
<span class="signoff">Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;</span><br/>
<br/>
</div>
<div class="list_head">
</div>
<table class="diff_tree">
<tr class="dark">
<td><a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci.c;h=77449a005752a067ef0c8f902a60049b9591d711;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6">arch/sparc64/kernel/pci.c</a></td>
<td></td>
<td class="link"><a href="#patch1">patch</a> | <a href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci.c;h=77449a005752a067ef0c8f902a60049b9591d711;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6">blob</a> | <a href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=history;f=arch/sparc64/kernel/pci.c;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6">history</a></td>
</tr>
<tr class="light">
<td><a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=2f61c4b1259606ee45ab004cd8e10d91bcb3b5ae;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6">arch/sparc64/kernel/pci_common.c</a></td>
<td></td>
<td class="link"><a href="#patch2">patch</a> | <a href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=2f61c4b1259606ee45ab004cd8e10d91bcb3b5ae;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6">blob</a> | <a href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=history;f=arch/sparc64/kernel/pci_common.c;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6">history</a></td>
</tr>
</table>
<br/>
<div class="patchset">
<div class="patch" id="patch1">
<div class="diff header">diff --git <a class="path" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci.c;h=55ad1b899bb8e945a3e049d09ef13e5e1fd167a5;hb=19d50b34bca36a44b570380022863fd2078d3323">a/arch/sparc64/kernel/pci.c</a> <a class="path" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci.c;h=77449a005752a067ef0c8f902a60049b9591d711;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6">b/arch/sparc64/kernel/pci.c</a></div>
<div class="diff extended_header">
index <a class="hash" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci.c;h=55ad1b899bb8e945a3e049d09ef13e5e1fd167a5;hb=19d50b34bca36a44b570380022863fd2078d3323">55ad1b8</a>..<a class="hash" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci.c;h=77449a005752a067ef0c8f902a60049b9591d711;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6">77449a0</a> 100644<span class="info"> (file)</span><br/>
</div>
<div class="diff from_file">--- a/<a class="path" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci.c;h=55ad1b899bb8e945a3e049d09ef13e5e1fd167a5;hb=19d50b34bca36a44b570380022863fd2078d3323">arch/sparc64/kernel/pci.c</a></div>
<div class="diff to_file">+++ b/<a class="path" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci.c;h=77449a005752a067ef0c8f902a60049b9591d711;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6">arch/sparc64/kernel/pci.c</a></div>
<div class="diff chunk_header"><span class="chunk_info">@@ <a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci.c;h=55ad1b899bb8e945a3e049d09ef13e5e1fd167a5;hb=19d50b34bca36a44b570380022863fd2078d3323#l422">-422,10</a> <a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci.c;h=77449a005752a067ef0c8f902a60049b9591d711;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6#l422">+422,15</a> @@</span><span class="section">&nbsp;struct&nbsp;pci_dev&nbsp;*of_create_pci_dev(struct&nbsp;pci_pbm_info&nbsp;*pbm,</span></div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;multifunction&nbsp;=&nbsp;0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;maybe&nbsp;a&nbsp;lie?&nbsp;*/</div>
<div class="diff">&nbsp;</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(host_controller)&nbsp;{</div>
<div class="diff rem">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;vendor&nbsp;=&nbsp;0x108e;</div>
<div class="diff rem">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;device&nbsp;=&nbsp;0x8000;</div>
<div class="diff rem">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;subsystem_vendor&nbsp;=&nbsp;0x0000;</div>
<div class="diff rem">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;subsystem_device&nbsp;=&nbsp;0x0000;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(tlb_type&nbsp;!=&nbsp;hypervisor)&nbsp;{</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pci_read_config_word(dev,&nbsp;PCI_VENDOR_ID,</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;dev-&gt;vendor);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pci_read_config_word(dev,&nbsp;PCI_DEVICE_ID,</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;dev-&gt;device);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;vendor&nbsp;=&nbsp;PCI_VENDOR_ID_SUN;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;device&nbsp;=&nbsp;0x80f0;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;cfg_size&nbsp;=&nbsp;256;</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;class&nbsp;=&nbsp;PCI_CLASS_BRIDGE_HOST&nbsp;&lt;&lt;&nbsp;8;</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf(pci_name(dev),&nbsp;&quot;%04x:%02x:%02x.%d&quot;,&nbsp;pci_domain_nr(bus),</div>
<div class="diff chunk_header"><span class="chunk_info">@@ <a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci.c;h=55ad1b899bb8e945a3e049d09ef13e5e1fd167a5;hb=19d50b34bca36a44b570380022863fd2078d3323#l818">-818,7</a> <a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci.c;h=77449a005752a067ef0c8f902a60049b9591d711;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6#l823">+823,7</a> @@</span><span class="section">&nbsp;int&nbsp;pci_host_bridge_read_pci_cfg(struct&nbsp;pci_bus&nbsp;*bus_dev,</span></div>
<div class="diff">&nbsp;{</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;u8&nbsp;fake_pci_config[]&nbsp;=&nbsp;{</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x8e,&nbsp;0x10,&nbsp;/*&nbsp;Vendor:&nbsp;0x108e&nbsp;(Sun)&nbsp;*/</div>
<div class="diff rem">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00,&nbsp;0x80,&nbsp;/*&nbsp;Device:&nbsp;0x8000&nbsp;(PBM)&nbsp;*/</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xf0,&nbsp;0x80,&nbsp;/*&nbsp;Device:&nbsp;0x80f0&nbsp;(Fire)&nbsp;*/</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x46,&nbsp;0x01,&nbsp;/*&nbsp;Command:&nbsp;0x0146&nbsp;(SERR,&nbsp;PARITY,&nbsp;MASTER,&nbsp;MEM)&nbsp;*/</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xa0,&nbsp;0x22,&nbsp;/*&nbsp;Status:&nbsp;0x02a0&nbsp;(DEVSEL_MED,&nbsp;FB2B,&nbsp;66MHZ)&nbsp;*/</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00,&nbsp;0x00,&nbsp;0x00,&nbsp;0x06,&nbsp;/*&nbsp;Class:&nbsp;0x06000000&nbsp;host&nbsp;bridge&nbsp;*/</div>
</div>
<div class="patch" id="patch2">
<div class="diff header">diff --git <a class="path" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=4249214608af63116aea1d2db4fd176b201a1e8a;hb=19d50b34bca36a44b570380022863fd2078d3323">a/arch/sparc64/kernel/pci_common.c</a> <a class="path" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=2f61c4b1259606ee45ab004cd8e10d91bcb3b5ae;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6">b/arch/sparc64/kernel/pci_common.c</a></div>
<div class="diff extended_header">
index <a class="hash" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=4249214608af63116aea1d2db4fd176b201a1e8a;hb=19d50b34bca36a44b570380022863fd2078d3323">4249214</a>..<a class="hash" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=2f61c4b1259606ee45ab004cd8e10d91bcb3b5ae;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6">2f61c4b</a> 100644<span class="info"> (file)</span><br/>
</div>
<div class="diff from_file">--- a/<a class="path" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=4249214608af63116aea1d2db4fd176b201a1e8a;hb=19d50b34bca36a44b570380022863fd2078d3323">arch/sparc64/kernel/pci_common.c</a></div>
<div class="diff to_file">+++ b/<a class="path" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=2f61c4b1259606ee45ab004cd8e10d91bcb3b5ae;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6">arch/sparc64/kernel/pci_common.c</a></div>
<div class="diff chunk_header"><span class="chunk_info">@@ <a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=4249214608af63116aea1d2db4fd176b201a1e8a;hb=19d50b34bca36a44b570380022863fd2078d3323#l44">-44,6</a> <a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=2f61c4b1259606ee45ab004cd8e10d91bcb3b5ae;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6#l44">+44,67</a> @@</span><span class="section">&nbsp;static&nbsp;void&nbsp;*sun4u_config_mkaddr(struct&nbsp;pci_pbm_info&nbsp;*pbm,</span></div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(void&nbsp;*)&nbsp;(pbm-&gt;config_space&nbsp;|&nbsp;bus&nbsp;|&nbsp;devfn&nbsp;|&nbsp;reg);</div>
<div class="diff">&nbsp;}</div>
<div class="diff">&nbsp;</div>
<div class="diff add">+/*&nbsp;At&nbsp;least&nbsp;on&nbsp;Sabre,&nbsp;it&nbsp;is&nbsp;necessary&nbsp;to&nbsp;access&nbsp;all&nbsp;PCI&nbsp;host&nbsp;controller</div>
<div class="diff add">+&nbsp;*&nbsp;registers&nbsp;at&nbsp;their&nbsp;natural&nbsp;size,&nbsp;otherwise&nbsp;zeros&nbsp;are&nbsp;returned.</div>
<div class="diff add">+&nbsp;*&nbsp;Strange&nbsp;but&nbsp;true,&nbsp;and&nbsp;I&nbsp;see&nbsp;no&nbsp;language&nbsp;in&nbsp;the&nbsp;UltraSPARC-IIi</div>
<div class="diff add">+&nbsp;*&nbsp;programmer&#39;s&nbsp;manual&nbsp;that&nbsp;mentions&nbsp;this&nbsp;even&nbsp;indirectly.</div>
<div class="diff add">+&nbsp;*/</div>
<div class="diff add">+static&nbsp;int&nbsp;sun4u_read_pci_cfg_host(struct&nbsp;pci_pbm_info&nbsp;*pbm,</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;char&nbsp;bus,&nbsp;unsigned&nbsp;int&nbsp;devfn,</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;where,&nbsp;int&nbsp;size,&nbsp;u32&nbsp;*value)</div>
<div class="diff add">+{</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u32&nbsp;tmp32,&nbsp;*addr;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u16&nbsp;tmp16;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u8&nbsp;tmp8;</div>
<div class="diff add">+</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr&nbsp;=&nbsp;sun4u_config_mkaddr(pbm,&nbsp;bus,&nbsp;devfn,&nbsp;where);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!addr)</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;PCIBIOS_SUCCESSFUL;</div>
<div class="diff add">+</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(size)&nbsp;{</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;1:</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(where&nbsp;&lt;&nbsp;8)&nbsp;{</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;long&nbsp;align&nbsp;=&nbsp;(unsigned&nbsp;long)&nbsp;addr;</div>
<div class="diff add">+</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;align&nbsp;&amp;=&nbsp;~1;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pci_config_read16((u16&nbsp;*)align,&nbsp;&amp;tmp16);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(where&nbsp;&amp;&nbsp;1)</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*value&nbsp;=&nbsp;tmp16&nbsp;&gt;&gt;&nbsp;8;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*value&nbsp;=&nbsp;tmp16&nbsp;&amp;&nbsp;0xff;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pci_config_read8((u8&nbsp;*)addr,&nbsp;&amp;tmp8);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*value&nbsp;=&nbsp;(u32)&nbsp;tmp8;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="diff add">+</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;2:</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(where&nbsp;&lt;&nbsp;8)&nbsp;{</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pci_config_read16((u16&nbsp;*)addr,&nbsp;&amp;tmp16);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*value&nbsp;=&nbsp;(u32)&nbsp;tmp16;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pci_config_read8((u8&nbsp;*)addr,&nbsp;&amp;tmp8);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*value&nbsp;=&nbsp;(u32)&nbsp;tmp8;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pci_config_read8(((u8&nbsp;*)addr)&nbsp;+&nbsp;1,&nbsp;&amp;tmp8);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*value&nbsp;|=&nbsp;((u32)&nbsp;tmp8)&nbsp;&lt;&lt;&nbsp;8;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="diff add">+</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;4:</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp32&nbsp;=&nbsp;0xffffffff;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sun4u_read_pci_cfg_host(pbm,&nbsp;bus,&nbsp;devfn,</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where,&nbsp;2,&nbsp;&amp;tmp32);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*value&nbsp;=&nbsp;tmp32;</div>
<div class="diff add">+</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp32&nbsp;=&nbsp;0xffffffff;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sun4u_read_pci_cfg_host(pbm,&nbsp;bus,&nbsp;devfn,</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;+&nbsp;2,&nbsp;2,&nbsp;&amp;tmp32);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*value&nbsp;|=&nbsp;tmp32&nbsp;&lt;&lt;&nbsp;16;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;PCIBIOS_SUCCESSFUL;</div>
<div class="diff add">+}</div>
<div class="diff add">+</div>
<div class="diff">&nbsp;static&nbsp;int&nbsp;sun4u_read_pci_cfg(struct&nbsp;pci_bus&nbsp;*bus_dev,&nbsp;unsigned&nbsp;int&nbsp;devfn,</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;where,&nbsp;int&nbsp;size,&nbsp;u32&nbsp;*value)</div>
<div class="diff">&nbsp;{</div>
<div class="diff chunk_header"><span class="chunk_info">@@ <a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=4249214608af63116aea1d2db4fd176b201a1e8a;hb=19d50b34bca36a44b570380022863fd2078d3323#l53">-53,10</a> <a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=2f61c4b1259606ee45ab004cd8e10d91bcb3b5ae;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6#l114">+114,6</a> @@</span><span class="section">&nbsp;static&nbsp;int&nbsp;sun4u_read_pci_cfg(struct&nbsp;pci_bus&nbsp;*bus_dev,&nbsp;unsigned&nbsp;int&nbsp;devfn,</span></div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u16&nbsp;tmp16;</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u8&nbsp;tmp8;</div>
<div class="diff">&nbsp;</div>
<div class="diff rem">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(bus_dev&nbsp;==&nbsp;pbm-&gt;pci_bus&nbsp;&amp;&amp;&nbsp;devfn&nbsp;==&nbsp;0x00)</div>
<div class="diff rem">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;pci_host_bridge_read_pci_cfg(bus_dev,&nbsp;devfn,&nbsp;where,</div>
<div class="diff rem">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size,&nbsp;value);</div>
<div class="diff rem">-</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(size)&nbsp;{</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;1:</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*value&nbsp;=&nbsp;0xff;</div>
<div class="diff chunk_header"><span class="chunk_info">@@ <a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=4249214608af63116aea1d2db4fd176b201a1e8a;hb=19d50b34bca36a44b570380022863fd2078d3323#l69">-69,6</a> <a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=2f61c4b1259606ee45ab004cd8e10d91bcb3b5ae;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6#l126">+126,10</a> @@</span><span class="section">&nbsp;static&nbsp;int&nbsp;sun4u_read_pci_cfg(struct&nbsp;pci_bus&nbsp;*bus_dev,&nbsp;unsigned&nbsp;int&nbsp;devfn,</span></div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="diff">&nbsp;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!bus_dev-&gt;number&nbsp;&amp;&amp;&nbsp;!PCI_SLOT(devfn))</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;sun4u_read_pci_cfg_host(pbm,&nbsp;bus,&nbsp;devfn,&nbsp;where,</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size,&nbsp;value);</div>
<div class="diff add">+</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr&nbsp;=&nbsp;sun4u_config_mkaddr(pbm,&nbsp;bus,&nbsp;devfn,&nbsp;where);</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!addr)</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;PCIBIOS_SUCCESSFUL;</div>
<div class="diff chunk_header"><span class="chunk_info">@@ <a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=4249214608af63116aea1d2db4fd176b201a1e8a;hb=19d50b34bca36a44b570380022863fd2078d3323#l101">-101,6</a> <a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=2f61c4b1259606ee45ab004cd8e10d91bcb3b5ae;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6#l162">+162,53</a> @@</span><span class="section">&nbsp;static&nbsp;int&nbsp;sun4u_read_pci_cfg(struct&nbsp;pci_bus&nbsp;*bus_dev,&nbsp;unsigned&nbsp;int&nbsp;devfn,</span></div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;PCIBIOS_SUCCESSFUL;</div>
<div class="diff">&nbsp;}</div>
<div class="diff">&nbsp;</div>
<div class="diff add">+static&nbsp;int&nbsp;sun4u_write_pci_cfg_host(struct&nbsp;pci_pbm_info&nbsp;*pbm,</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;char&nbsp;bus,&nbsp;unsigned&nbsp;int&nbsp;devfn,</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;where,&nbsp;int&nbsp;size,&nbsp;u32&nbsp;value)</div>
<div class="diff add">+{</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u32&nbsp;*addr;</div>
<div class="diff add">+</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr&nbsp;=&nbsp;sun4u_config_mkaddr(pbm,&nbsp;bus,&nbsp;devfn,&nbsp;where);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!addr)</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;PCIBIOS_SUCCESSFUL;</div>
<div class="diff add">+</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(size)&nbsp;{</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;1:</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(where&nbsp;&lt;&nbsp;8)&nbsp;{</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;long&nbsp;align&nbsp;=&nbsp;(unsigned&nbsp;long)&nbsp;addr;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u16&nbsp;tmp16;</div>
<div class="diff add">+</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;align&nbsp;&amp;=&nbsp;~1;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pci_config_read16((u16&nbsp;*)align,&nbsp;&amp;tmp16);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(where&nbsp;&amp;&nbsp;1)&nbsp;{</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp16&nbsp;&amp;=&nbsp;0x00ff;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp16&nbsp;|=&nbsp;value&nbsp;&lt;&lt;&nbsp;8;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp16&nbsp;&amp;=&nbsp;0xff00;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp16&nbsp;|=&nbsp;value;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pci_config_write16((u16&nbsp;*)align,&nbsp;tmp16);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pci_config_write8((u8&nbsp;*)addr,&nbsp;value);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;2:</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(where&nbsp;&lt;&nbsp;8)&nbsp;{</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pci_config_write16((u16&nbsp;*)addr,&nbsp;value);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pci_config_write8((u8&nbsp;*)addr,&nbsp;value&nbsp;&amp;&nbsp;0xff);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pci_config_write8(((u8&nbsp;*)addr)&nbsp;+&nbsp;1,&nbsp;value&nbsp;&gt;&gt;&nbsp;8);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;4:</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sun4u_write_pci_cfg_host(pbm,&nbsp;bus,&nbsp;devfn,</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where,&nbsp;2,&nbsp;value&nbsp;&amp;&nbsp;0xffff);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sun4u_write_pci_cfg_host(pbm,&nbsp;bus,&nbsp;devfn,</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;+&nbsp;2,&nbsp;2,&nbsp;value&nbsp;&gt;&gt;&nbsp;16);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;PCIBIOS_SUCCESSFUL;</div>
<div class="diff add">+}</div>
<div class="diff add">+</div>
<div class="diff">&nbsp;static&nbsp;int&nbsp;sun4u_write_pci_cfg(struct&nbsp;pci_bus&nbsp;*bus_dev,&nbsp;unsigned&nbsp;int&nbsp;devfn,</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;where,&nbsp;int&nbsp;size,&nbsp;u32&nbsp;value)</div>
<div class="diff">&nbsp;{</div>
<div class="diff chunk_header"><span class="chunk_info">@@ <a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=4249214608af63116aea1d2db4fd176b201a1e8a;hb=19d50b34bca36a44b570380022863fd2078d3323#l108">-108,9</a> <a class="list" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=blob;f=arch/sparc64/kernel/pci_common.c;h=2f61c4b1259606ee45ab004cd8e10d91bcb3b5ae;hb=27997abfcb1f8bb534720b18f3487de3906c7ac6#l216">+216,10</a> @@</span><span class="section">&nbsp;static&nbsp;int&nbsp;sun4u_write_pci_cfg(struct&nbsp;pci_bus&nbsp;*bus_dev,&nbsp;unsigned&nbsp;int&nbsp;devfn,</span></div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;char&nbsp;bus&nbsp;=&nbsp;bus_dev-&gt;number;</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u32&nbsp;*addr;</div>
<div class="diff">&nbsp;</div>
<div class="diff rem">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(bus_dev&nbsp;==&nbsp;pbm-&gt;pci_bus&nbsp;&amp;&amp;&nbsp;devfn&nbsp;==&nbsp;0x00)</div>
<div class="diff rem">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;pci_host_bridge_write_pci_cfg(bus_dev,&nbsp;devfn,&nbsp;where,</div>
<div class="diff rem">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size,&nbsp;value);</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!bus_dev-&gt;number&nbsp;&amp;&amp;&nbsp;!PCI_SLOT(devfn))</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;sun4u_write_pci_cfg_host(pbm,&nbsp;bus,&nbsp;devfn,&nbsp;where,</div>
<div class="diff add">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size,&nbsp;value);</div>
<div class="diff add">+</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr&nbsp;=&nbsp;sun4u_config_mkaddr(pbm,&nbsp;bus,&nbsp;devfn,&nbsp;where);</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!addr)</div>
<div class="diff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;PCIBIOS_SUCCESSFUL;</div>
</div>
</div>
</div>
<div class="page_footer">
<div class="page_footer_text">David Miller&#39;s SPARC tree.</div>
<a class="rss_logo" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=rss">RSS</a> <a class="rss_logo" href="/?p=linux/kernel/git/davem/sparc-2.6.git;a=atom">Atom</a>
</div>
</body>
</html>